<div class="tedi-search__input-wrapper">
  <input
    type="text"
    [(ngModel)]="_inputValue"
    class="tedi-search__input"
    [cdkMenuTriggerFor]="searchPanel"
    [placeholder]="placeholder()"
    [disabled]="disabled()"
    #searchInput
  />
</div>

<div class="tedi-search__suffix">
  @if (clearable() && _inputValue()) {
    <button
      type="reset"
      tedi-close-button
      [small]="size() !== 'large'"
      [smallIcon]="size() !== 'large'"
      (click)="clearResult($event)"
    ></button>
    @if (!withButton()) {
      <div class="tedi-search__suffix-separator"></div>
    }
  }
  @if (!withButton()) {
    <tedi-icon name="search" color="secondary" [size]="iconSize()" />
  }
</div>

@if (withButton()) {
  <button
    tedi-button
    class="tedi-search__trigger"
    [size]="buttonSize()"
    (click)="searchButtonClick()"
    [disabled]="disabled()"
  >
    <tedi-icon name="search" color="white" [size]="iconSize()" />
    {{ buttonText() }}
  </button>
}

<ng-template #searchPanel>
  <div cdkMenu>
    @let inputValue = _inputValue();
    @if (inputValue && inputValue.length >= this.autocompleteFrom()) {
      <tedi-card class="tedi-search__panel" [style.width.px]="_width()">
        @if (_foundOptions().length) {
          <tedi-card-content padding="none" [hasSeparator]="true">
            @for (option of _foundOptions(); track option.value) {
              <button
                cdkMenuItem
                tedi-dropdown-item
                [value]="option.value"
                (cdkMenuItemTriggered)="selectResult(option)"
              >
                @if (option.description) {
                  <strong>{{ option.label }}</strong> Â· {{ option.description }}
                } @else {
                  {{ option.label }}
                }
              </button>
            }
          </tedi-card-content>
        } @else {
          <tedi-card-content [hasSeparator]="true" padding="md">
            {{ noResultText() }}
          </tedi-card-content>
        }

        <tedi-card-content class="tedi-search__footer-content" padding="md">
          <ng-content></ng-content>
        </tedi-card-content>
      </tedi-card>
    }
  </div>
</ng-template>
