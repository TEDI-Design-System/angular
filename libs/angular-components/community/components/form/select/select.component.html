<button
  tedi-input
  type="button"
  [state]="state()"
  [size]="size()"
  [cdkMenuTriggerFor]="selectDropdown"
  [disabled]="_disabled()"
  (click)="onTouched()"
  class="tedi-select__trigger"
>
  <span
    class="tedi-select__label"
    [class.tedi-select__label--placeholder]="!_selectedValue()"
  >
    @if (selectedLabel(); as label) {
      <ng-container [ngTemplateOutlet]="label" />
    } @else {
      {{ placeholder() }}
    }
  </span>

  @if (_selectedValue()) {
    <button
      type="reset"
      [attr.aria-label]="'Clear'"
      title="Clear"
      class="tedi-select__clear"
      (click)="$event.stopPropagation(); clear()"
    >
      <tedi-icon name="clear" color="tertiary" />
    </button>
  }
  <tedi-icon class="tedi-select__arrow" name="arrow_drop_down" />
</button>
@for (option of _options(); track option.value) {
  @if (option.value() === _selectedValue()) {
    <ng-container [ngTemplateOutlet]="option.templateRef() ?? null" />
  }
}

<ng-template #selectDropdown>
  <tedi-card
    cdkMenu
    class="tedi-select__dropdown"
    spacing="none"
    [style.width.px]="_width()"
  >
    <tedi-card-content class="tedi-select__dropdown-content">
      @for (option of _options(); track option.value) {
        <button
          cdkMenuItem
          tedi-dropdown-item
          (cdkMenuItemTriggered)="select(option.value())"
          [selected]="option.value() === _selectedValue()"
          [disabled]="option.isDisabled()"
        >
          <ng-template [ngTemplateOutlet]="option.templateRef() ?? null" />
        </button>
      }
    </tedi-card-content>
  </tedi-card>
</ng-template>
