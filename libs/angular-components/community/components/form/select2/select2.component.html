<div
  tedi-input
  cdkOverlayOrigin
  #trigger="cdkOverlayOrigin"
  role="combobox"
  aria-haspopup="listbox"
  (click)="toggleIsOpen()"
  (keydown.enter)="toggleIsOpen()"
  (keydown.space)="$event.preventDefault(); toggleIsOpen()"
  tabindex="0"
  class="tedi-select__trigger"
>
  @if (selectedOptions.length === 1) {
    {{ selectedOptions }}
  } @else if (selectedOptions.length > 1) {
    @for (option of selectedOptions; track option) {
      {{ option }}
    }
  } @else {
    placeholder
  }

  @if (selectedOptions.length > 0) {
    <button
      type="button"
      tedi-closing-button
      size="small"
      [iconSize]="18"
      title="Clear"
      (click)="$event.stopPropagation(); clear()"
    ></button>
  }

  <tedi-icon class="tedi-select__arrow" name="arrow_drop_down" />
</div>

<ng-template
  cdkConnectedOverlay
  [cdkConnectedOverlayOrigin]="trigger"
  [cdkConnectedOverlayOpen]="isOpen()"
  (detach)="toggleIsOpen(false)"
>
  <tedi-card spacing="none" [style.width.px]="dropdownWidth()">
    <tedi-card-content>
      <ul
        cdkListbox
        cdkListboxUseActiveDescendant
        [cdkListboxValue]="selectedOptions"
        (cdkListboxValueChange)="handleValueChange($event)"
        aria-labelledby="example-spatula-label"
      >
        @for (option of options(); track option) {
          <li
            tedi-dropdown-item
            [selected]="isOptionSelected(option.value())"
            [cdkOption]="option.value()"
            [cdkOptionDisabled]="option.disabled()"
          >
            {{ option.label() }}
          </li>
        }
      </ul>
    </tedi-card-content>
  </tedi-card>
</ng-template>
